#!/usr/bin/env sos-runner
#fileformat=SOS1.0

parameter: theme = path('pm-template.latex')
parameter: notebook = path()
parameter: fontsize = "12pt"
parameter: papersize = "a4paper"
parameter: titlepage = "titlepage" # set to "notitlepage" to disable title page
parameter: urlcolor = "cyan"
parameter: highlight = "tango" # set to "" to disable syntax highlight
fail_if(not notebook.is_file(), msg = 'Need input parameter ``--notebook``')

[ipynb_md: provides = '{data}.md']
output: f'{data}.md'
run: expand = True, stderr = False
     jupyter nbconvert {data}.ipynb --to markdown

# see https://jdhao.github.io/2017/12/10/pandoc-markdown-with-chinese/
[default]
depends: executable('pandoc')
input: f'{notebook:n}.md', theme
output: f'{notebook:n}.pdf'
run: docker_image = "gaow/debian-texlive", expand = True
     pandoc --toc -N --smart --latex-engine=xelatex --template={_input[1]:n} {"--highlight-style" if highlight else ""} {highlight} -V urlcolor={urlcolor} -V fontsize={fontsize} -V papersize={papersize} -V titlepage={titlepage} -o {_output} {_input[0]} && rm -f {_input[0]}